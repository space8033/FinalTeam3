<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.finalteam3.exodia.chat.dao.ChatDao">
	<insert id="insertChatRoom" parameterType="ChatRoom">
    <selectKey keyProperty="chatRoom_no" resultType="int" order="BEFORE">
        select SEQ_CHATROOM.nextval from dual
    </selectKey>
    insert into CHATROOM(
        CHATROOM_NO, CHATROOM_CREATEDAT, CHATROOM_LASTMSGID
    )
    values(
        #{chatRoom_no}, to_char(sysdate, 'yyyy.MM.dd HH24:mi:ss'), #{chatRoom_lastMsgId}
    )
	</insert>
	
	<insert id="insertChatMessage" parameterType="ChatMessage">
    <selectKey keyProperty="chatMessage_no" resultType="int" order="BEFORE">
        select SEQ_CHATMESSAGE.nextval from dual
    </selectKey>
	 insert into CHATMESSAGE (
	    CHATMESSAGE_NO, CHATMESSAGE_CREATEDAT, MESSAGE_READ, CHATROOM_NO, MESSAGE_CONTENT, EMPINFO_NO
	)
	values (
	    #{chatMessage_no}, to_char(sysdate, 'yyyy.MM.dd HH24:mi:ss'), #{message_read}, #{chatroom_no}, #{message_content}, #{empinfo_no}
	)
	</insert>
		
	<select id="selectChatRoomNo" parameterType="ChatParticipant" resultType="int">
	
		SELECT DISTINCT A.CHATROOM_NO
		FROM chatMessage A, chatMessage B
		WHERE A.CHATROOM_NO = B.CHATROOM_NO
		  AND A.EMPINFO_NO = #{empInfo_no1}
		  AND B.EMPINFO_NO = #{empInfo_no2}
 		  
	</select>
	
    <select id="selectChatHistory" parameterType="int" resultType="ChatMessage">
		SELECT CHATMESSAGE_NO, MESSAGE_CREATEDAT, MESSAGE_READ, CHATROOM_NO, MESSAGE_CONTENT, EMPINFO_NO
		  FROM chatMessage
		 WHERE chatRoom_no = #{chatRoom_no}
 		  
	</select>
	
	<!-- <update id="deleteAlarmByAlarmNo" parameterType="int">
		update alarm 
		   set alarm_deletedAt=to_char(sysdate,'yyyy.mm.dd hh24:mi:ss')
  		 where alarm_no = #{alarm_no}
	</update>
	
	<update id="updateAlarmReadByAlarmNo" parameterType="AlarmRequest">
		update alarm
		   set alarm_isRead = #{alarm_isRead}
  		 where alarm_no = #{alarm_no}
	</update> -->
	
</mapper>