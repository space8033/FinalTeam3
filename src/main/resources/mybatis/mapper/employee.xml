<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.finalteam3.exodia.employee.dao.EmployeeDao">
	
	<insert id="insertEmp" parameterType="JoinRequest">
		<selectKey keyProperty="emp_no" resultType="int" order="BEFORE">
	         select seq_emp.nextval from dual
      	</selectKey>
      	
      	insert into emp(emp_no, emp_id, emp_password, emp_isinit)
      	values(#{emp_no}, #{emp_id}, '{noop}0000', #{emp_isinit})
	</insert>

	<insert id="insertEmpInfo" parameterType="JoinRequest">
		<selectKey keyProperty="empinfo_no" resultType="int" order="BEFORE">
	         select seq_empinfo.nextval from dual
      	</selectKey>
      	
      	insert into empinfo(empinfo_no, empinfo_name, empinfo_position, empinfo_phone, empinfo_email, empinfo_createdat, emp_no)
      	values(#{empinfo_no}, #{empinfo_name}, #{empinfo_position}, #{empinfo_phone}, #{empinfo_email}, to_char(sysdate,'yyyy.mm.dd hh24:mi:ss'), #{emp_no})
	</insert>
	
	<select id="selectEmpByEmpId" parameterType="String" resultType="LoginResponse">
		select e.emp_id, e.emp_password, e.emp_no, e.emp_isinit, e.emp_deletedAt, r.role_category
		from emp e, role r
		where project_no = 0
		and emp_id = #{emp_id}
	</select>
	
	<select id="selectNoByEmpId" resultType="int" parameterType="String">
		select emp_no
		from emp
		where emp_id = #{emp_id}
	</select>
	
	<select id="selectNoByEmpName" resultType="int" parameterType="String">
		select emp_no
		from empinfo
		where empinfo_name = #{empinfo_name}
	</select>

	<select id="selectInfoByEmpId" resultType="LoginResponse" parameterType="LoginRequest">
		select e.emp_no, e.emp_id, e.emp_password, e.emp_isinit, e.emp_deletedAt, r.role_category
		from emp e, role r
		where project_no = #{project_no}
		and emp_id = #{emp_id}
	</select>
	
	<update id="updateStatus" parameterType="String">
		update emp set emp_status = 'connected' where emp_id = #{emp_id}
	</update>
	
	<update id="updatePassword" parameterType="Map">
		update emp set emp_password = #{emp_password}, emp_isinit = #{emp_isinit} where emp_id = #{emp_id}
	</update>
	
	<select id="selectInfoByEmpNo" resultType="EmployeeInfo" parameterType="int">
		select empinfo_no, empinfo_name, empinfo_position, empinfo_phone, empinfo_email, empinfo_createdat
		from empinfo
		where emp_no = #{emp_no}
	</select>
</mapper>